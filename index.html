<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•´ì™¸ì†¡ê¸ˆ ì „í™˜ìœ¨ ê°œì„  ì„íŒ©íŠ¸ ê³„ì‚°ê¸°</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 30px 20px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: white;
      font-size: 2rem;
      margin-bottom: 30px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .calculator {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }

    .funnel-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .funnel-step {
      background: #f8f9ff;
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid #667eea;
    }

    .step-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .step-title {
      font-weight: 600;
      font-size: 1.1rem;
      color: #333;
    }

    .step-badge {
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .step-inputs {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    label {
      font-size: 0.9rem;
      color: #666;
      font-weight: 500;
    }

    input[type="number"] {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .conversion-display {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      padding: 10px;
      background: white;
      border-radius: 8px;
    }

    .conversion-rate {
      font-size: 1.5rem;
      font-weight: 700;
      color: #667eea;
    }

    .conversion-label {
      color: #999;
      font-size: 0.9rem;
    }

    .improvement-section {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      border-radius: 12px;
      padding: 20px;
    }

    .improvement-inputs {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .btn-calculate {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin: 30px 0;
    }

    .btn-calculate:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .results {
      display: none;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 16px;
      padding: 30px;
    }

    .results.show {
      display: block;
    }

    .results-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      text-align: center;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .result-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .result-label {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
    }

    .result-value {
      font-size: 2rem;
      font-weight: 700;
      color: #667eea;
    }

    .result-unit {
      font-size: 1rem;
      color: #999;
      margin-left: 5px;
    }

    .impact-highlight {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
    }

    .impact-value {
      font-size: 3rem;
      font-weight: 700;
      margin: 10px 0;
    }

    .arrow-down {
      text-align: center;
      color: #667eea;
      font-size: 1.5rem;
      margin: 10px 0;
    }

    .save-section {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .save-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    input[type="date"] {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
    }

    .btn-save {
      padding: 12px 24px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-save:hover {
      background: #45a049;
      transform: translateY(-1px);
    }

    .saved-data-list {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
    }

    .saved-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 2px solid transparent;
      transition: all 0.2s;
      cursor: pointer;
    }

    .saved-item:hover {
      border-color: #667eea;
      transform: translateX(5px);
    }

    .saved-item-info {
      flex: 1;
    }

    .saved-item-date {
      font-weight: 700;
      color: #333;
      font-size: 1.1rem;
      margin-bottom: 5px;
    }

    .saved-item-stats {
      font-size: 0.85rem;
      color: #666;
    }

    .saved-item-actions {
      display: flex;
      gap: 10px;
    }

    .btn-load, .btn-delete {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-load {
      background: #667eea;
      color: white;
    }

    .btn-load:hover {
      background: #5568d3;
    }

    .btn-delete {
      background: #f44336;
      color: white;
    }

    .btn-delete:hover {
      background: #da190b;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ í•´ì™¸ì†¡ê¸ˆ ì „í™˜ìœ¨ ê°œì„  ì„íŒ©íŠ¸ ê³„ì‚°ê¸°</h1>

    <div class="calculator">
      <!-- ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° -->
      <div class="section">
        <div class="save-section">
          <div style="font-weight: 600; margin-bottom: 15px; font-size: 1.1rem;">ğŸ’¾ ë°ì´í„° ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°</div>
          <div class="save-controls">
            <input type="date" id="save_date" />
            <input type="text" id="save_label" placeholder="ë©”ëª¨ (ì„ íƒì‚¬í•­)" style="flex: 1; min-width: 200px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;" />
            <button class="btn-save" onclick="saveData()">ğŸ’¾ í˜„ì¬ ì§€í‘œ ì €ì¥</button>
            <button class="btn-save" onclick="loadFromGoogleSheets()" style="background: #4285f4;">ğŸ“¥ êµ¬ê¸€ì‹œíŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          </div>
          <div class="saved-data-list" id="savedDataList"></div>
        </div>
      </div>

      <!-- í˜„ì¬ ì§€í‘œ -->
      <div class="section">
        <div class="section-title">ğŸ“Š í˜„ì¬ ì§€í‘œ</div>

        <div class="funnel-container">
          <!-- Step 1: íšŒì›ê°€ì… -->
          <div class="funnel-step">
            <div class="step-header">
              <div class="step-title">1ï¸âƒ£ íšŒì›ê°€ì…</div>
              <div class="step-badge">ì‹œì‘ì </div>
            </div>
            <div class="step-inputs">
              <div class="input-group">
                <label>ì›”ê°„ ì‹ ê·œ ê°€ì…ì ìˆ˜</label>
                <input type="number" id="signups" value="1000" min="0">
              </div>
            </div>
          </div>

          <div class="arrow-down">â†“</div>

          <!-- Step 2: KYC -->
          <div class="funnel-step">
            <div class="step-header">
              <div class="step-title">2ï¸âƒ£ KYC ì™„ë£Œ</div>
              <div class="step-badge">ë³¸ì¸ì¸ì¦</div>
            </div>
            <div class="step-inputs">
              <div class="input-group">
                <label>KYC ì™„ë£Œìœ¨ (%)</label>
                <input type="number" id="kyc_rate" value="70" min="0" max="100" step="0.1">
              </div>
            </div>
            <div class="conversion-display">
              <span class="conversion-rate" id="kyc_users">700</span>
              <span class="conversion-label">ëª…ì´ KYC ì™„ë£Œ</span>
            </div>
          </div>

          <div class="arrow-down">â†“</div>

          <!-- Step 3: ì†¡ê¸ˆì‹ ì²­ ì‹œì‘ -->
          <div class="funnel-step">
            <div class="step-header">
              <div class="step-title">3ï¸âƒ£ ì†¡ê¸ˆì‹ ì²­ ì‹œì‘</div>
              <div class="step-badge">ì‹ ì²­ ì°©ìˆ˜</div>
            </div>
            <div class="step-inputs">
              <div class="input-group">
                <label>ì†¡ê¸ˆì‹ ì²­ ì‹œì‘ìœ¨ (%)</label>
                <input type="number" id="start_rate" value="60" min="0" max="100" step="0.1">
              </div>
            </div>
            <div class="conversion-display">
              <span class="conversion-rate" id="start_users">420</span>
              <span class="conversion-label">ëª…ì´ ì†¡ê¸ˆì‹ ì²­ ì‹œì‘</span>
            </div>
          </div>

          <div class="arrow-down">â†“</div>

          <!-- Step 4: ì†¡ê¸ˆì‹ ì²­ ì™„ë£Œ -->
          <div class="funnel-step">
            <div class="step-header">
              <div class="step-title">4ï¸âƒ£ ì†¡ê¸ˆì‹ ì²­ ì™„ë£Œ</div>
              <div class="step-badge">ì‹ ì²­ ì œì¶œ</div>
            </div>
            <div class="step-inputs">
              <div class="input-group">
                <label>ì†¡ê¸ˆì‹ ì²­ ì™„ë£Œìœ¨ (%)</label>
                <input type="number" id="complete_rate" value="80" min="0" max="100" step="0.1">
              </div>
            </div>
            <div class="conversion-display">
              <span class="conversion-rate" id="complete_users">336</span>
              <span class="conversion-label">ëª…ì´ ì†¡ê¸ˆì‹ ì²­ ì™„ë£Œ</span>
            </div>
          </div>

          <div class="arrow-down">â†“</div>

          <!-- Step 5: ì…ê¸ˆì™„ë£Œ -->
          <div class="funnel-step">
            <div class="step-header">
              <div class="step-title">5ï¸âƒ£ ì…ê¸ˆì™„ë£Œ</div>
              <div class="step-badge">ìê¸ˆ ì˜ˆì¹˜</div>
            </div>
            <div class="step-inputs">
              <div class="input-group">
                <label>ì…ê¸ˆì™„ë£Œìœ¨ (%)</label>
                <input type="number" id="deposit_rate" value="85" min="0" max="100" step="0.1">
              </div>
            </div>
            <div class="conversion-display">
              <span class="conversion-rate" id="deposit_users">286</span>
              <span class="conversion-label">ëª…ì´ ì…ê¸ˆì™„ë£Œ</span>
            </div>
          </div>

          <div class="arrow-down">â†“</div>

          <!-- Step 6: ì†¡ê¸ˆì™„ë£Œ -->
          <div class="funnel-step">
            <div class="step-header">
              <div class="step-title">6ï¸âƒ£ ì†¡ê¸ˆì™„ë£Œ</div>
              <div class="step-badge">ìµœì¢… ì „í™˜</div>
            </div>
            <div class="step-inputs">
              <div class="input-group">
                <label>ì†¡ê¸ˆì™„ë£Œìœ¨ (%)</label>
                <input type="number" id="remit_rate" value="95" min="0" max="100" step="0.1">
              </div>
            </div>
            <div class="conversion-display">
              <span class="conversion-rate" id="remit_users">272</span>
              <span class="conversion-label">ëª…ì´ ì²«ì†¡ê¸ˆ ì™„ë£Œ</span>
            </div>
          </div>
        </div>

        <!-- ì „ì²´ ì „í™˜ìœ¨ í‘œì‹œ -->
        <div style="margin-top: 30px; padding: 20px; background: #667eea; color: white; border-radius: 12px; text-align: center;">
          <div style="font-size: 0.9rem; margin-bottom: 5px;">ì „ì²´ ì „í™˜ìœ¨ (ê°€ì… â†’ ì²«ì†¡ê¸ˆ)</div>
          <div style="font-size: 2.5rem; font-weight: 700;" id="overall_rate">27.2%</div>
        </div>
      </div>

      <!-- ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ -->
      <div class="section">
        <div class="section-title">ğŸ’° ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ</div>
        <div class="step-inputs">
          <div class="input-group">
            <label>í‰ê·  ì²«ì†¡ê¸ˆ ê¸ˆì•¡ (ì›)</label>
            <input type="number" id="avg_amount" value="1000000" min="0" step="10000">
          </div>
          <div class="input-group">
            <label>í‰ê·  ìˆ˜ìˆ˜ë£Œìœ¨ (%)</label>
            <input type="number" id="fee_rate" value="0.8" min="0" max="100" step="0.01">
          </div>
        </div>
      </div>

      <!-- ê°œì„  ì‹œë‚˜ë¦¬ì˜¤ -->
      <div class="section">
        <div class="section-title">ğŸ¯ ê°œì„  ì‹œë‚˜ë¦¬ì˜¤</div>
        <div class="improvement-section">
          <div style="font-weight: 600; margin-bottom: 10px;">ì–´ëŠ ë‹¨ê³„ë¥¼ ê°œì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
          <div class="improvement-inputs">
            <div class="input-group">
              <label>ê°œì„  íƒ€ê²Ÿ KYC ì™„ë£Œìœ¨ (%)</label>
              <input type="number" id="target_kyc" value="70" min="0" max="100" step="0.1">
            </div>
            <div class="input-group">
              <label>ê°œì„  íƒ€ê²Ÿ ì†¡ê¸ˆì‹ ì²­ ì‹œì‘ìœ¨ (%)</label>
              <input type="number" id="target_start" value="60" min="0" max="100" step="0.1">
            </div>
            <div class="input-group">
              <label>ê°œì„  íƒ€ê²Ÿ ì†¡ê¸ˆì‹ ì²­ ì™„ë£Œìœ¨ (%)</label>
              <input type="number" id="target_complete" value="80" min="0" max="100" step="0.1">
            </div>
            <div class="input-group">
              <label>ê°œì„  íƒ€ê²Ÿ ì…ê¸ˆì™„ë£Œìœ¨ (%)</label>
              <input type="number" id="target_deposit" value="85" min="0" max="100" step="0.1">
            </div>
            <div class="input-group">
              <label>ê°œì„  íƒ€ê²Ÿ ì†¡ê¸ˆì™„ë£Œìœ¨ (%)</label>
              <input type="number" id="target_remit" value="95" min="0" max="100" step="0.1">
            </div>
          </div>
        </div>
      </div>

      <button class="btn-calculate" onclick="calculate()">ğŸ’¡ ì„íŒ©íŠ¸ ê³„ì‚°í•˜ê¸°</button>

      <!-- ê²°ê³¼ -->
      <div class="results" id="results">
        <div class="results-title">ğŸ“ˆ ì˜ˆìƒ ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸</div>

        <div class="impact-highlight">
          <div style="font-size: 1.2rem;">ê°œì„  í›„ ì „ì²´ ì „í™˜ìœ¨</div>
          <div class="impact-value" id="result_new_rate">-</div>
          <div style="font-size: 1rem; opacity: 0.9;">
            (<span id="result_rate_diff">-</span> ì¦ê°€)
          </div>
        </div>

        <div style="height: 30px;"></div>

        <div class="results-grid">
          <div class="result-card">
            <div class="result-label">ì¶”ê°€ ì²«ì†¡ê¸ˆ ìœ ì €</div>
            <div class="result-value" id="result_additional_users">-</div>
            <div class="result-unit">ëª…/ì›”</div>
          </div>

          <div class="result-card">
            <div class="result-label">ì¶”ê°€ ì†¡ê¸ˆì•¡ (GMV)</div>
            <div class="result-value" id="result_additional_gmv">-</div>
            <div class="result-unit">ì›/ì›”</div>
          </div>

          <div class="result-card">
            <div class="result-label">ì¶”ê°€ ìˆ˜ìˆ˜ë£Œ ìˆ˜ìµ</div>
            <div class="result-value" id="result_additional_revenue">-</div>
            <div class="result-unit">ì›/ì›”</div>
          </div>

          <div class="result-card">
            <div class="result-label">ì—°ê°„ ì˜ˆìƒ ìˆ˜ìµ ì¦ê°€</div>
            <div class="result-value" id="result_yearly_revenue">-</div>
            <div class="result-unit">ì›/ë…„</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ì‹¤ì‹œê°„ ê³„ì‚° ì—…ë°ì´íŠ¸
    function updateCalculations() {
      const signups = parseFloat(document.getElementById('signups').value) || 0;
      const kycRate = parseFloat(document.getElementById('kyc_rate').value) || 0;
      const startRate = parseFloat(document.getElementById('start_rate').value) || 0;
      const completeRate = parseFloat(document.getElementById('complete_rate').value) || 0;
      const depositRate = parseFloat(document.getElementById('deposit_rate').value) || 0;
      const remitRate = parseFloat(document.getElementById('remit_rate').value) || 0;

      const kycUsers = signups * (kycRate / 100);
      const startUsers = kycUsers * (startRate / 100);
      const completeUsers = startUsers * (completeRate / 100);
      const depositUsers = completeUsers * (depositRate / 100);
      const remitUsers = depositUsers * (remitRate / 100);

      document.getElementById('kyc_users').textContent = Math.round(kycUsers);
      document.getElementById('start_users').textContent = Math.round(startUsers);
      document.getElementById('complete_users').textContent = Math.round(completeUsers);
      document.getElementById('deposit_users').textContent = Math.round(depositUsers);
      document.getElementById('remit_users').textContent = Math.round(remitUsers);

      const overallRate = (remitUsers / signups) * 100;
      document.getElementById('overall_rate').textContent = overallRate.toFixed(1) + '%';
    }

    function calculate() {
      const signups = parseFloat(document.getElementById('signups').value) || 0;
      const avgAmount = parseFloat(document.getElementById('avg_amount').value) || 0;
      const feeRate = parseFloat(document.getElementById('fee_rate').value) || 0;

      // í˜„ì¬ ì „í™˜ìœ¨
      const currentKyc = parseFloat(document.getElementById('kyc_rate').value) || 0;
      const currentStart = parseFloat(document.getElementById('start_rate').value) || 0;
      const currentComplete = parseFloat(document.getElementById('complete_rate').value) || 0;
      const currentDeposit = parseFloat(document.getElementById('deposit_rate').value) || 0;
      const currentRemit = parseFloat(document.getElementById('remit_rate').value) || 0;

      // ê°œì„  í›„ ì „í™˜ìœ¨
      const targetKyc = parseFloat(document.getElementById('target_kyc').value) || 0;
      const targetStart = parseFloat(document.getElementById('target_start').value) || 0;
      const targetComplete = parseFloat(document.getElementById('target_complete').value) || 0;
      const targetDeposit = parseFloat(document.getElementById('target_deposit').value) || 0;
      const targetRemit = parseFloat(document.getElementById('target_remit').value) || 0;

      // í˜„ì¬ ìµœì¢… ì „í™˜ìœ¨
      const currentOverallRate = (currentKyc / 100) * (currentStart / 100) * (currentComplete / 100) * (currentDeposit / 100) * (currentRemit / 100);
      const currentRemitUsers = signups * currentOverallRate;

      // ê°œì„  í›„ ìµœì¢… ì „í™˜ìœ¨
      const newOverallRate = (targetKyc / 100) * (targetStart / 100) * (targetComplete / 100) * (targetDeposit / 100) * (targetRemit / 100);
      const newRemitUsers = signups * newOverallRate;

      // ì„íŒ©íŠ¸ ê³„ì‚°
      const additionalUsers = newRemitUsers - currentRemitUsers;
      const additionalGMV = additionalUsers * avgAmount;
      const additionalRevenue = additionalGMV * (feeRate / 100);
      const yearlyRevenue = additionalRevenue * 12;

      const rateDiff = ((newOverallRate - currentOverallRate) * 100).toFixed(1);

      // ê²°ê³¼ í‘œì‹œ
      document.getElementById('result_new_rate').textContent = (newOverallRate * 100).toFixed(1) + '%';
      document.getElementById('result_rate_diff').textContent = '+' + rateDiff + '%p';
      document.getElementById('result_additional_users').textContent = Math.round(additionalUsers).toLocaleString();
      document.getElementById('result_additional_gmv').textContent = Math.round(additionalGMV).toLocaleString();
      document.getElementById('result_additional_revenue').textContent = Math.round(additionalRevenue).toLocaleString();
      document.getElementById('result_yearly_revenue').textContent = Math.round(yearlyRevenue).toLocaleString();

      document.getElementById('results').classList.add('show');
      document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }

    // í˜„ì¬ ì§€í‘œ ì…ë ¥ ë³€ê²½ì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
    ['signups', 'kyc_rate', 'start_rate', 'complete_rate', 'deposit_rate', 'remit_rate'].forEach(id => {
      document.getElementById(id).addEventListener('input', updateCalculations);
    });

    // ì´ˆê¸° ê³„ì‚° ë° ê°œì„  íƒ€ê²Ÿ ê¸°ë³¸ê°’ ì„¤ì •
    updateCalculations();
    document.getElementById('target_kyc').value = document.getElementById('kyc_rate').value;
    document.getElementById('target_start').value = document.getElementById('start_rate').value;
    document.getElementById('target_complete').value = document.getElementById('complete_rate').value;
    document.getElementById('target_deposit').value = document.getElementById('deposit_rate').value;
    document.getElementById('target_remit').value = document.getElementById('remit_rate').value;

    // LocalStorage ê´€ë ¨ í•¨ìˆ˜ë“¤
    const STORAGE_KEY = 'remittance_metrics_data';
    const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbxItp1Ebs9LpJFFSpK-XTgmWZ3UfZST19j5OEBcXTwtWy6LeUStgElXDGEKZZfn0xk/exec';

    function saveData() {
      const date = document.getElementById('save_date').value;
      if (!date) {
        alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      const data = {
        date: date,
        label: document.getElementById('save_label').value || '',
        signups: parseFloat(document.getElementById('signups').value) || 0,
        kycRate: parseFloat(document.getElementById('kyc_rate').value) || 0,
        startRate: parseFloat(document.getElementById('start_rate').value) || 0,
        completeRate: parseFloat(document.getElementById('complete_rate').value) || 0,
        depositRate: parseFloat(document.getElementById('deposit_rate').value) || 0,
        remitRate: parseFloat(document.getElementById('remit_rate').value) || 0,
        avgAmount: parseFloat(document.getElementById('avg_amount').value) || 0,
        feeRate: parseFloat(document.getElementById('fee_rate').value) || 0,
        savedAt: new Date().toISOString()
      };

      // ì „ì²´ ì „í™˜ìœ¨ ê³„ì‚°
      const overallRate = (data.kycRate / 100) * (data.startRate / 100) * (data.completeRate / 100) *
                          (data.depositRate / 100) * (data.remitRate / 100) * 100;
      data.overallRate = overallRate;

      // ê¸°ì¡´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
      let savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

      // ê°™ì€ ë‚ ì§œê°€ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
      const existingIndex = savedData.findIndex(item => item.date === date);
      if (existingIndex >= 0) {
        if (confirm('í•´ë‹¹ ë‚ ì§œì˜ ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          savedData[existingIndex] = data;
        } else {
          return;
        }
      } else {
        savedData.push(data);
      }

      // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
      savedData.sort((a, b) => new Date(b.date) - new Date(a.date));

      // ì €ì¥
      localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));

      // Google Sheetsì—ë„ ì €ì¥
      saveToGoogleSheets(data);

      // UI ì—…ë°ì´íŠ¸
      displaySavedData();

      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      document.getElementById('save_label').value = '';

      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    async function saveToGoogleSheets(data) {
      try {
        const response = await fetch(GOOGLE_SHEET_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        console.log('Google Sheetsì— ì €ì¥ ì™„ë£Œ');
      } catch (error) {
        console.error('Google Sheets ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }

    function loadData(date) {
      const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      const data = savedData.find(item => item.date === date);

      if (!data) {
        alert('ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ë°ì´í„° ë¡œë“œ
      document.getElementById('signups').value = data.signups;
      document.getElementById('kyc_rate').value = data.kycRate;
      document.getElementById('start_rate').value = data.startRate;
      document.getElementById('complete_rate').value = data.completeRate;
      document.getElementById('deposit_rate').value = data.depositRate;
      document.getElementById('remit_rate').value = data.remitRate;
      document.getElementById('avg_amount').value = data.avgAmount;
      document.getElementById('fee_rate').value = data.feeRate;

      // ê°œì„  íƒ€ê²Ÿë„ ë™ì¼í•˜ê²Œ ì„¤ì •
      document.getElementById('target_kyc').value = data.kycRate;
      document.getElementById('target_start').value = data.startRate;
      document.getElementById('target_complete').value = data.completeRate;
      document.getElementById('target_deposit').value = data.depositRate;
      document.getElementById('target_remit').value = data.remitRate;

      // ê³„ì‚° ì—…ë°ì´íŠ¸
      updateCalculations();

      alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
    }

    function deleteData(date) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      let savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      savedData = savedData.filter(item => item.date !== date);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));

      displaySavedData();
      alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function displaySavedData() {
      const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      const container = document.getElementById('savedDataList');

      if (savedData.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      container.innerHTML = savedData.map(data => {
        const dateObj = new Date(data.date);
        const displayDate = dateObj.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
        const remitUsers = Math.round(data.signups * (data.overallRate / 100));

        return `
          <div class="saved-item">
            <div class="saved-item-info">
              <div class="saved-item-date">${displayDate} ${data.label ? '- ' + data.label : ''}</div>
              <div class="saved-item-stats">
                ê°€ì…ì: ${data.signups.toLocaleString()}ëª… |
                ì „ì²´ ì „í™˜ìœ¨: ${data.overallRate.toFixed(1)}% |
                ì²«ì†¡ê¸ˆ: ${remitUsers.toLocaleString()}ëª…
              </div>
            </div>
            <div class="saved-item-actions">
              <button class="btn-load" onclick="loadData('${data.date}')">ë¶ˆëŸ¬ì˜¤ê¸°</button>
              <button class="btn-delete" onclick="deleteData('${data.date}')">ì‚­ì œ</button>
            </div>
          </div>
        `;
      }).join('');
    }

    async function loadFromGoogleSheets() {
      try {
        const response = await fetch(GOOGLE_SHEET_URL);
        const data = await response.json();

        if (data.status === 'error') {
          alert('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + data.message);
          return;
        }

        // ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸
        if (!Array.isArray(data)) {
          console.error('ì˜ˆìƒì¹˜ ëª»í•œ ë°ì´í„° í˜•ì‹:', data);
          alert('ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return;
        }

        // LocalStorageì— Google Sheets ë°ì´í„° ë³‘í•©
        let localData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        // Google Sheets ë°ì´í„°ë¥¼ LocalStorage í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        data.forEach(sheetItem => {
          const existingIndex = localData.findIndex(item => item.date === sheetItem.date);
          if (existingIndex >= 0) {
            localData[existingIndex] = sheetItem;
          } else {
            localData.push(sheetItem);
          }
        });

        // ë‚ ì§œìˆœ ì •ë ¬
        localData.sort((a, b) => new Date(b.date) - new Date(a.date));

        // ì €ì¥
        localStorage.setItem(STORAGE_KEY, JSON.stringify(localData));

        // UI ì—…ë°ì´íŠ¸
        displaySavedData();

        alert('êµ¬ê¸€ì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
      } catch (error) {
        console.error('Google Sheets ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
        alert('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
      }
    }

    // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ˆê¸°í™”
    document.getElementById('save_date').valueAsDate = new Date();

    // ì €ì¥ëœ ë°ì´í„° í‘œì‹œ
    displaySavedData();
  </script>
</body>
</html>
